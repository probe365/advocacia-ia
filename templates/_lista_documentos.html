{# _lista_documentos.html #}
{% for doc in documentos %}
  {# Nome do arquivo: tenta vÃ¡rios campos, na ordem #}
  {% set nome_arquivo =
      doc.filename
      or doc.arquivo_nome
      or doc.titulo
      or doc.source
      or (doc.metadata.source if doc.metadata is defined and doc.metadata and doc.metadata.source is defined else None)
      or (doc.storage_path.split('/')[-1] if doc.storage_path is defined and doc.storage_path else '')
  %}
  {% set nome_arquivo = nome_arquivo or 'Nome nÃ£o disponÃ­vel' %}

  {# Tipo do documento: pode vir como type ou tipo #}
  {% set tipo_doc = doc.type or doc.tipo or 'N/A' %}

  {# NÃºmero de chunks: tenta vÃ¡rios campos comuns; default = 0 #}
  {% set num_chunks =
      doc.num_chunks
      or doc.chunks
      or doc.n_chunks
      or doc.chunk_count
      or 0
  %}

  <div class="list-group-item d-flex justify-content-between align-items-center">
    <div>
      <div><strong>{{ nome_arquivo }}</strong></div>
      <div class="small text-muted">
        Tipo: {{ tipo_doc }} ({{ num_chunks }} chunks)
      </div>
    </div>

    <div class="btn-group btn-group-sm">
      {# VISUALIZAR â€“ chama preview (HTMX) #}
      <button
        class="btn btn-outline-primary"
        hx-get="{{ url_for(
                    'processos.ui_preview_documento',
                    id_processo=id_processo,
                    filename=nome_arquivo
                 ) }}"
        hx-target="#preview-area"
        hx-swap="innerHTML">
        Visualizar
      </button>

      {# ABRIR â€“ usa a rota ui_arquivo para servir o arquivo bruto #}
      <a
        class="btn btn-outline-secondary"
        href="{{ url_for('processos.ui_arquivo',
                        id_processo=id_processo,
                        nome_arquivo='uploads/' ~ doc.filename) }}"
        target="_blank">
        Abrir
      </a>


      {# EXCLUIR â€“ envia DELETE para a rota correta #}
      <button
        class="btn btn-outline-danger"
        hx-delete="{{ url_for(
                       'processos.ui_delete_documento',
                       id_processo=id_processo,
                       filename=nome_arquivo
                    ) }}"
        hx-target="#lista-documentos"
        hx-swap="innerHTML"
        hx-confirm="Tem certeza que deseja excluir este documento?">
        ðŸ—‘
      </button>
    </div>
  </div>
{% endfor %}
