<div class="card">
  <div class="card-header bg-primary text-white">
    <div class="d-flex justify-content-between align-items-center">
      <h6 class="mb-0">
        <i class="bi bi-file-text"></i> {{ filename }}
      </h6>
      <div>
        {% if from_fallback %}
          <span class="badge bg-warning text-dark">Fallback</span>
        {% else %}
          <span class="badge bg-success">{{ total_chunks }} chunks</span>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="card-body" style="max-height: 600px; overflow-y: auto;">
    <div class="mb-3">
      <button class="btn btn-sm btn-outline-secondary" onclick="copyFullDocumentContent()">
        <i class="bi bi-clipboard"></i> Copiar Tudo
      </button>
      <button class="btn btn-sm btn-outline-primary" onclick="downloadDocumentContent('{{ filename }}')">
        <i class="bi bi-download"></i> Download
      </button>
    </div>
    <pre id="document-content" class="bg-light p-3 rounded" style="white-space: pre-wrap; word-wrap: break-word; font-size: 0.95em; color: #212529 !important; background-color: #f8f9fa !important; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">{{ content }}</pre>
  </div>
</div>

<script>
function copyFullDocumentContent() {
  const content = document.getElementById('document-content').textContent;
  navigator.clipboard.writeText(content).then(() => {
    const btn = event.target.closest('button');
    const originalHtml = btn.innerHTML;
    btn.innerHTML = '<i class="bi bi-check-circle"></i> Copiado!';
    btn.classList.remove('btn-outline-secondary');
    btn.classList.add('btn-success');
    
    setTimeout(() => {
      btn.innerHTML = originalHtml;
      btn.classList.remove('btn-success');
      btn.classList.add('btn-outline-secondary');
    }, 2000);
  }).catch(err => {
    console.error('Erro ao copiar:', err);
    alert('Erro ao copiar conte√∫do');
  });
}

function downloadDocumentContent(filename) {
  const content = document.getElementById('document-content').textContent;
  const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}
</script>
